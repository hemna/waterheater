<!DOCTYPE html>
<html>
<head>
    <title>Water Heater Motor Control</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/main.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            console.log("Document ready");
            initial_temperature = parseInt('{{ initial_temperature|safe }}');
            $("#currentTemperature").val(initial_temperature);
            $("#increaseTemp").click(function() {
                console.log("Increasing temperature");
                socket.emit('change_temperature', {'temperature': 1});
            });
            $("#decreaseTemp").click(function() {
                console.log("Decreasing temperature");
                socket.emit('change_temperature', {'temperature': -1});
            });
            $("#setTemperature").click(function() {
                console.log("Setting temperature");
                // Set the temperature in the app to the current temperature
                // reading on the heater
                socket.emit('set_temperature_reading', {'temperature': $("#currentTemperature").val()});
            });
            $("#lowTemperature").click(function() {
                console.log("Setting temperature to 97F");
                socket.emit('set_temperature', {'temperature': 97});
            });
            $("#highTemperature").click(function() {
                console.log("Setting temperature to 108F");
                socket.emit('set_temperature', {'temperature': 108});
            });
        });
    </script>
</head>
<body>
    <h1>Water Heater Motor Control</h1>
    <!-- Motor Control Form
    <form id="motorForm">
        <label>Steps: <input type="number" name="steps" value="100" min="1" required></label><br>
        <label>Step Type:
            <select name="steptype">
                <option value="Full">Full</option>
                <option value="1/2">1/2</option>
                <option value="1/4">1/4</option>
                <option value="1/8">1/8</option>
                <option value="1/16">1/16</option>
                <option value="1/32">1/32</option>
            </select>
        </label><br>
        <label>Clockwise:
            <select name="clockwise">
                <option value="true">True</option>
                <option value="false">False</option>
            </select>
        </label><br>
        <button type="submit">Move Motor</button>
    </form>
    -->
    <div id="result"></div>
    <br><br>
    <div class="form-floating">
        <input id="currentTemperature" class="form-control form-control-lg" style="width: 160px;" type="number" name="temperature" value="0"></label>
        <label for="currentTemperature">Current Temperature</label>
      </div>
    <br>
    <button id="setTemperature" class="btn btn-success">Set Current Temperature</button>
    <br><br>
    <button id="decreaseTemp" class="btn btn-primary">Decrease Temperature</button>
    <button id="increaseTemp" class="btn btn-danger">Increase Temperature</button>
    <br><br>
    <button id="lowTemperature" class="btn btn-outline-primary">Set to 97F</button>
    <button id="highTemperature" class="btn btn-outline-danger">Set to 108F</button>
    <script>
        document.getElementById('motorForm').onsubmit = function(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                steps: parseInt(form.steps.value),
                steptype: form.steptype.value,
                clockwise: form.clockwise.value === 'true'
            };
            document.getElementById('result').innerText = 'Moving motor...';
            console.log("Calling move_motor");
            socket.emit('move_motor',  data);
        };
        socket.on('motor_status', function(msg) {
            document.getElementById('result').innerText = msg.message;
        });
    </script>
</body>
</html>
